# C语言中的内存模型

## 5个内存模型说明

C语言中的内存模型分为5个区：栈区（stack）、堆区（heap）、静态区/全局区（static）、常量区、代码区。

1. 栈区：存放函数的**参数值**、**局部变量**等，由编译器自动分配和释放，通常**在函数执行完后就释放**了，其操作方式类似于数据结构中的栈。栈内存分配运算内置于CPU的指令集，效率很高，但是分配的内存量有限。
2. 堆区：就是通过new、malloc、realloc分配的内存块，一般**由程序员分配释放，若程序员不释放，程序结束时可能由OS回收**。分配方式类似于数据结构中的链表。“内存泄漏”通常说的就是堆区。
3. 静态区：全局变量和静态变量的存储是放在一块的。初始化的全局变量和静态变量在一块区域，未初始化的全局变量和未初始化的静态变量在相邻的另一块区域，程序结束后**由系统释放**。
4. 常量区：常量字符串就是放在这里的，程序结束后**由系统释放**。不允许修改。
5. 代码区：顾名思义，存放代码。存放函数体的二进制代码。

![C语言内存模型](https://gitee.com/victor513044829/picture-for-document/raw/master/images/202309040943808.jpeg)

## 栈区和堆区大小差异

**栈区**：栈区是**向低地址**扩展的，是一块**连续的内存区域**。这就导致栈顶的地址和栈的最大容量是**系统预先规定好的**，大小在进程分配时是确定的，具体大小由编译器、操作系统决定。所需大小一般小于10M，因为栈是**用来快速存取**的。

**堆区**：堆区是**向高地址**扩展的，是**不连续的内存区域**，因为需要手动进行分配，因此会大一些，大小不固定。

## 栈区和堆区效率差异

**栈区**：由系统自动分配，速度较快，但程序员无法控制。如果栈的剩余空间小于所申请空间，系统将报异常提示栈溢出。

**堆区**：由程序员分配的内存，一般速度较慢，且容易产生内存碎片。如果存放在堆中的数据如果不进行释放，很可能会造成内存泄漏，因为并不一定能够触发gc机制回收，因此对于堆中的内存使用，用完要记得释放。

# C源文件和头文件

## #include <>和#include ""的区别和注意点

1. `#include <>`：只搜索系统类库，不搜索本地。Linux下类库目录是`/usr/include/`。
2. `#include " "`：优先查找当前目录是否有指定名称的头文件，如果没有再从标准头文件目录中查找。

# 关键字

1\. 数据类型(常用char, short, int, long, unsigned, float, double)

* char：字符类型，1 byte，使用ASCII编码，0~255
* short：

2\. 运算和表达式(=, +, -, *, while, do-while, if, goto, switch-case)

3\. 数据存储(auto，static ，extern，const，register，volatile，restricted)

4\. 结构(struct, enum, union,typedef),

5\. 位操作和逻辑运算(<<, >>, &, |, ~，^, &&)，

6\. 预处理(#define, #include, #error，#if…#elif…#else…#endif等)，

7\. 平台扩展关键字(__asm, __inline，__syscall)